{% extends "./index.html" %}

{% block title %} Detalle Movimiento {% endblock %}
{% load auth_extras %}

{% block body %}
{%load static%}

<head>
    <link href="{% static 'css/sb-admin-2.min.css' %}" rel="stylesheet">
</head>

<body>

<div class="container text-left">
    <br>
    <div class="row">
        <div class="col-sm-2">

        </div>
        <div class="col-sm-8 p-3">
            <div class="registration-form" style="background-color: #fff;max-width: 600px;
                            margin: auto;
                            padding: 50px 70px;
                            border-top-left-radius: 30px;
                            border-top-right-radius: 30px;
                            border-bottom-left-radius: 30px;
                            border-bottom-right-radius: 30px;
                            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.075);">

                <div class="registration-form"
                    style="background-color: #fff; max-width: 600px; box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.075);">
                    


                    <div class="card" style="width: 100%;">
                        <div class="card-header">
                            <h1 class="text-center text-sm-center lead mb-3" style="color: black;">
                                <b>Detalle de Movimiento</b>
                            </h1>
                        </div>
                        <ul class="list-group list-group-flush">

                            <li class="list-group-item"><label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Fecha de Registro:</b> {{ movimiento.fecha_modificacion }}</label></li>
                            <li class="list-group-item"><label id="doc_type" class="form-select form-select-lg mb-3"
                                    style="width:100%; box-sizing: border-box;"><b>Fecha de Edición:</b> {{ movimiento.fecha_registro }}</label></li>
                            <li class="list-group-item"><label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Unidad de Negocio:</b> {{ unidad_negocio }}</label></li>
                            {% if movimiento.tipo_ingreso == 'OUT' %}
                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Unidad Productiva:</b> {{ movimiento.unidad_productiva }}</label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Centro de Costo:</b> {{centro_costo }}</label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Subcentro de  Costo:</b> {{ movimiento.sub_centro_costo }}</label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                    style="width:100%; box-sizing: border-box;"><b>Nombre del Proveedor:</b> {{movimiento.nombre_proveedor }}
                                </label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                    style="width:100%; box-sizing: border-box;"><b>Tipo Documento:</b> {{movimiento.tipo_documento }}
                                </label>
                            </li>
                            
                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                    style="width:100%; box-sizing: border-box;"><b>Nro Documento: </b>{{movimiento.numero_documento }}
                                </label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Número de factura:</b> {{movimiento.numero_factura }}</label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Comprobante de factura:</b>Comprobante de factura: <a href="{{server_url}}movimiento/comprobante/{{movimiento.pk}}" target="_blank"> {{movimiento.comprobante_factura }}</a></label>
                            </li>
                            
                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Fecha de factura:</b> {{ movimiento.fecha_factura }}</label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Concepto:</b> {{ movimiento.concepto }}</label>
                            </li class="list-group-item">
                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Valor:</b> {{ valor_f }}</label>
                            </li class="list-group-item">

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Estado: </b>{{ movimiento.estado }}</label>
                            </li class="list-group-item">

                            {% endif %}

                            {% if movimiento.tipo_ingreso == 'IN' and movimiento.ingreso_bancario == True %}

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Unidad Productiva:</b> {{ movimiento.unidad_productiva }}</label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Tipo de Movimiento:</b> {{ movimiento.accion }}</label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                    style="width:100%; box-sizing: border-box;"><b>Tipo Documento:</b> {{movimiento.tipo_documento }}
                                </label>
                            </li>
                            
                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                    style="width:100%; box-sizing: border-box;"><b>Nro Documento: </b>{{movimiento.numero_documento }}
                                </label>
                            </li>

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                    style="width:100%; box-sizing: border-box;"><b>Detalle de la negociación: </b>{{movimiento.negociacion }}
                                </label>
                            </li>
                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Valor:</b> {{ valor_f }}</label>
                            </li class="list-group-item">

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Concepto:</b> {{ movimiento.concepto }}</label>
                            </li class="list-group-item">

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Estado: </b>{{ movimiento.estado }}</label>
                            </li class="list-group-item">




                            {% endif %}

                            {% if movimiento.tipo_ingreso == 'IN' and movimiento.ingreso_bancario == False %}

                            <li class="list-group-item">
                                {% if movimiento.unidad_productiva %}
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Usuario Común: </b>{{ movimiento.unidad_productiva.usuarioRegistro }}</label>
                                {% else %}
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Usuario Común: </b>{{ movimiento.unidad_productiva_admin }}</label>
                                {% endif %}
                            </li class="list-group-item">

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Tipo de Movimiento:</b> {{ movimiento.accion }}</label>
                            </li>


                            

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Valor:</b> {{ valor_f }}</label>
                            </li class="list-group-item">
                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Concepto:</b> {{ movimiento.concepto }}</label>
                            </li class="list-group-item">

                            <li class="list-group-item">
                                <label id="doc_type" class="form-select form-select-lg mb-3"
                                style="width:100%; box-sizing: border-box;"><b>Estado: </b>{{ movimiento.estado }}</label>
                            </li class="list-group-item">






                            {% endif %}
                            

                            
                            


                        </ul>
                        <button class="btn btn-primary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                            Mostrar Comentarios
                        </button>
                        <div class="collapse mb-3" id="collapseExample">

                            {% for comentario in comentarios%}
                            <div class="card border-dark mb-3" style="width: 100%;">
                                <div class="card-header">{{comentario.fecha_registro}}</div>
                                <div class="card-body">
                                    <h5 class="card-title">{{comentario.usuario}}</h5>
                                    <p class="card-text">{{comentario.comentario}}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                    {% if 'Rechazado' == movimiento.estado and user.is_authenticated and user|has_group:"Comun" %}
                    <form method="GET" action="{{server_url}}movimiento/editar/{{movimiento.pk}}">
                    <div class="form-floating  mb-3">
                        <input class="btn btn-block btn-primary" style="color: #fff;" type="submit" value="Corregir Movimiento">
                    </div>
                </form>
                    {% elif 'Rechazado' == movimiento.estado and user.is_authenticated and user|has_group:"Administrador" %}
                    <form method="GET" action="{{server_url}}movimiento/editar/{{movimiento.pk}}">
                        <div class="form-floating  mb-3">
                            <input class="btn btn-block btn-primary" style="color: #fff;" type="submit" value="Corregir Movimiento">
                        </div>
                    </form>
                    {% endif %}
                    
                    {% if user.is_authenticated and user|has_group:"Auditor" %}

                    {% if movimiento.estado == 'En proceso' %}

                    <form method="POST" action="{{server_url}}movimiento/addnote/{{movimiento.pk}}/">
                        {% csrf_token %}
                        <label for="exampleFormControlTextarea1" class="form-label mb-3">Comentario Adicional:</label>
                        <textarea class="form-control" id="comentario" name="comentario"
                            rows="3" ></textarea>
                            <input class="btn btn-block btn-primary" style="color: #fff;" name="action" type="submit" value="Agregar Nota">
                    </form>

                    <div class="mb-3"></div>


                    <form method="GET" action="{{server_url}}movimiento/aprob/{{movimiento.pk}}/">
                        {% csrf_token %}                      
                    <div class="form-floating  mb-3">
                        
                        <input class="btn btn-block btn-success" style="color: #fff;" name="action" type="submit" value="Aprobar">
                        
                    </div>
                    </form>
                    <form method="GET" action="{{server_url}}movimiento/rechazar/{{movimiento.pk}}/">
                        {% csrf_token %}                      
                    <div class="form-floating  mb-3">
                        
                        <input class="btn btn-block btn-warning" style="color: #fff;" name="action" type="submit" value="Rechazar">
                        
                    </div>
                    </form>
                    

                    {% if user.is_authenticated and user|has_group:"Auditor" %}
                    <a href="{{ server_url }}movimiento/eliminar/{{ movimiento.pk }}">
                        <input class="btn btn-block btn-danger" style="color: #fff;" value="Eliminar">
                    </a>
                    {% endif %}

                    
                    {% endif %}

                    {% endif %}

                </div>


            </div>





        </div>
        <div class="col-sm-2">

        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
    integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
    integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
    crossorigin="anonymous"></script>
{% endblock %}